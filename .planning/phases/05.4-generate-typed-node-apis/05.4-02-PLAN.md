---
phase: 05.4-generate-typed-node-apis
plan: 02
type: execute
wave: 2
depends_on: ["05.4-01"]
files_modified:
  - generated/factories/index.ts
  - src/codegen/typed-api.ts
  - src/index.ts
  - src/codegen/tests/typed-api.test.ts
autonomous: true

must_haves:
  truths:
    - "createTypedNodes() returns factories for all 797 nodes organized by category"
    - "Existing typed-api tests still pass (backward compatibility)"
    - "All generated factory modules compile without TypeScript errors"
    - "Generated factories produce valid WorkflowNode objects with correct type strings and auto-injected resource/operation"
  artifacts:
    - path: "generated/factories/index.ts"
      provides: "Aggregated createTypedNodes() returning all 797 node factories"
      exports: ["createTypedNodes", "TypedNodes"]
    - path: "src/codegen/typed-api.ts"
      provides: "Re-exports from generated factories (thin wrapper for backward compat)"
      exports: ["createTypedNodes", "TypedNodes"]
    - path: "src/codegen/tests/typed-api.test.ts"
      provides: "Tests for generated factories including backward compat and new nodes"
  key_links:
    - from: "generated/factories/index.ts"
      to: "generated/factories/*.ts"
      via: "imports and aggregates all category factory modules"
      pattern: "import.*from.*factories"
    - from: "src/codegen/typed-api.ts"
      to: "generated/factories/index.ts"
      via: "re-exports createTypedNodes"
      pattern: "export.*from.*generated/factories"
    - from: "src/index.ts"
      to: "src/codegen/typed-api.ts"
      via: "public API export"
      pattern: "export.*typed-api"
---

<objective>
Wire up generated factories into the public API with backward compatibility.

Purpose: The generated factory modules from Plan 01 need an aggregation layer (`generated/factories/index.ts`) that assembles all per-category factories into the `createTypedNodes()` return value. The existing `typed-api.ts` becomes a thin re-export wrapper. Existing tests must still pass.

Output:
- `generated/factories/index.ts` — assembles all factories into `TypedNodes` interface
- Updated `src/codegen/typed-api.ts` — re-exports from generated factories
- Updated `src/index.ts` — exports remain unchanged (backward compat)
- Updated tests verifying both old patterns and new 797-node coverage
</objective>

<execution_context>
@/Users/jurissleiners/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jurissleiners/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md

@src/codegen/typed-api.ts
@src/index.ts
@src/builder/types.ts
@src/codegen/tests/typed-api.test.ts
@.planning/phases/05.4-generate-typed-node-apis/05.4-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create factories index and update typed-api.ts</name>
  <files>generated/factories/index.ts, src/codegen/typed-api.ts, src/index.ts</files>
  <action>
**generated/factories/index.ts** — This file is generated by the CLI (Plan 01), but needs to:

1. Import all per-category factory modules (triggers, transform, input, output, langchain, etc.)
2. Define the full `TypedNodes` interface covering all 797 nodes:
   - Simple nodes: `nodes.webhook(name, params)`, `nodes.httpRequest(name, params)`, etc.
   - Resource/operation nodes: `nodes.slack.message.post(name, params)`, etc.
   - The interface is a nested object where:
     - Top level: node names in camelCase (e.g., `webhook`, `httpRequest`, `slack`, `gmail`)
     - For resource/op nodes: second level is resource, third level is operation
3. Export `createTypedNodes(): TypedNodes` that assembles the full factory object
4. Re-export `Expression` and `ResourceLocator` types for downstream consumers

The `generateFactoryModules()` function from Plan 01 should generate this index file as one of its outputs. If Plan 01 doesn't generate the index, this task creates it.

**src/codegen/typed-api.ts** — Replace the hand-written 181-line file with a thin re-export:

```typescript
/**
 * Typed node API factory
 * Re-exports from generated factories for backward compatibility.
 * Factory functions are auto-generated by `npm run generate`.
 */
export { createTypedNodes } from '../../generated/factories/index.js';
export type { TypedNodes } from '../../generated/factories/index.js';
export type { Expression, ResourceLocator } from '../../generated/nodes.js';
```

This preserves the existing import path (`src/codegen/typed-api`) while delegating to generated code.

**src/index.ts** — No changes needed if imports from `typed-api.ts` still work. Verify the existing exports still resolve.

Run `npx tsc --noEmit` to confirm everything compiles.
  </action>
  <verify>
  `npx tsc --noEmit` passes with zero errors.
  `node -e "const m = await import('./dist/index.js'); console.log(typeof m.createTypedNodes)"` prints "function" (after build).
  </verify>
  <done>
  `createTypedNodes()` is exported from the public API and returns factories for all 797 nodes.
  `typed-api.ts` is a thin re-export wrapper.
  TypeScript compilation passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update tests and verify backward compatibility</name>
  <files>src/codegen/tests/typed-api.test.ts</files>
  <action>
Update `src/codegen/tests/typed-api.test.ts` to:

1. **Keep all existing tests** — they must still pass exactly as-is. This verifies backward compatibility:
   - `nodes.webhook(name, params)` still works
   - `nodes.httpRequest(name, params)` still works
   - `nodes.if(name, params)` still works
   - `nodes.set(name, params)` still works
   - `nodes.slack.message.post(name, params)` still works with auto-injected resource/operation
   - `nodes.slack.channel.create(name, params)` still works
   - Builder integration test still passes

2. **Add new tests** for generated coverage:
   - Test a resource/operation node that wasn't hand-written before (e.g., Gmail):
     ```typescript
     it('gmail.message.send produces correct WorkflowNode', () => {
       const result = nodes.gmail.message.send('Send Email', {
         sendTo: 'test@example.com',
         subject: 'Test',
         message: 'Hello',
       });
       expect(result.type).toBe('n8n-nodes-base.gmail');
       expect(result.parameters.resource).toBe('message');
       expect(result.parameters.operation).toBe('send');
     });
     ```
   - Test a simple node that wasn't hand-written before (e.g., Code):
     ```typescript
     it('code produces correct WorkflowNode', () => {
       const result = nodes.code('Script', { jsCode: 'return items;' });
       expect(result.type).toBe('n8n-nodes-base.code');
       expect(result.parameters.jsCode).toBe('return items;');
     });
     ```
   - Test that the TypedNodes object has the expected structure for a few known nodes (spot check, not exhaustive)

3. Run `npx vitest run src/codegen/tests/typed-api.test.ts` to verify all tests pass.

4. Run the full test suite `npx vitest run` to verify no regressions anywhere.
  </action>
  <verify>
  `npx vitest run src/codegen/tests/typed-api.test.ts` — all tests pass (existing + new).
  `npx vitest run` — full suite passes, no regressions.
  </verify>
  <done>
  All 12+ existing typed-api tests pass unchanged.
  New tests verify generated factories for nodes not previously hand-written.
  Full test suite has zero regressions.
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` — zero errors
- `npx vitest run` — full suite passes
- `nodes.webhook()`, `nodes.slack.message.post()` still work (backward compat)
- `nodes.gmail.message.send()` works (new generated factory)
- `createTypedNodes()` returns an object with 797 node factories
</verification>

<success_criteria>
- createTypedNodes() returns factories for all 797 nodes organized by category
- Existing typed-api tests pass without modification (backward compatibility)
- Generated factories compile and produce valid WorkflowNode objects
- Full test suite has zero regressions
</success_criteria>

<output>
After completion, create `.planning/phases/05.4-generate-typed-node-apis/05.4-02-SUMMARY.md`
</output>
