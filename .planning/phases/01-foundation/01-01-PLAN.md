---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - src/index.ts
  - src/schema/types.ts
  - src/schema/extractor.ts
  - src/schema/cache.ts
  - cli/extract.ts
  - .env.example
autonomous: true
user_setup:
  - service: n8n
    why: "Schema extraction source"
    env_vars:
      - name: N8N_API_URL
        source: "Local n8n instance URL (default: http://localhost:5678)"
      - name: N8N_API_KEY
        source: "n8n Settings -> API -> Create API Key"

must_haves:
  truths:
    - "Running `npm run extract` pulls node schemas from local n8n and saves them as JSON"
    - "Extracted schemas persist as .json files that can be read without n8n running"
    - "Schema TypeScript types accurately model the n8n node type structure including properties, displayOptions, and credentials"
  artifacts:
    - path: "package.json"
      provides: "Project configuration with ESM, TypeScript, vitest"
      contains: "n8n-workflow-sdk"
    - path: "src/schema/types.ts"
      provides: "TypeScript interfaces for n8n schema format"
      exports: ["N8nNodeType", "N8nProperty", "N8nDisplayOptions", "N8nCredential"]
    - path: "src/schema/extractor.ts"
      provides: "REST API client for n8n node type extraction"
      exports: ["extractNodeTypes", "extractNodeType"]
    - path: "src/schema/cache.ts"
      provides: "Local JSON file caching for extracted schemas"
      exports: ["writeSchema", "readSchema", "listCachedSchemas"]
    - path: "cli/extract.ts"
      provides: "CLI entry point for schema extraction"
  key_links:
    - from: "cli/extract.ts"
      to: "src/schema/extractor.ts"
      via: "imports and calls extractNodeTypes"
      pattern: "extractNodeType"
    - from: "cli/extract.ts"
      to: "src/schema/cache.ts"
      via: "writes extracted schemas to cache"
      pattern: "writeSchema"
    - from: "src/schema/extractor.ts"
      to: "n8n REST API"
      via: "HTTP GET with X-N8N-API-KEY header"
      pattern: "X-N8N-API-KEY"
---

<objective>
Set up the n8n-workflow-sdk project and implement schema extraction from a local n8n instance with local JSON caching.

Purpose: Establish the project foundation and data pipeline — all downstream type generation depends on having accurate, cached n8n schemas.
Output: Working project with `npm run extract` that pulls n8n node schemas and persists them as local JSON files.
</objective>

<execution_context>
@/Users/jurissleiners/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jurissleiners/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold project and define schema types</name>
  <files>package.json, tsconfig.json, src/index.ts, src/schema/types.ts, .env.example</files>
  <action>
Initialize the n8n-workflow-sdk project:

1. Create `package.json` with:
   - name: "n8n-workflow-sdk", version: "0.1.0", type: "module"
   - scripts: build (tsc), extract (tsx cli/extract.ts), generate (tsx cli/generate.ts), test (vitest run)
   - devDependencies: typescript, tsx, vitest, dotenv
   - main: ./dist/index.js, types: ./dist/index.d.ts

2. Create `tsconfig.json` with:
   - target: ES2022, module: NodeNext, moduleResolution: NodeNext
   - strict: true, outDir: ./dist, rootDir: ./src
   - include: ["src/**/*", "cli/**/*"]

3. Create `.env.example` with N8N_API_URL and N8N_API_KEY placeholders.

4. Create `src/schema/types.ts` with TypeScript interfaces that model the n8n node type schema structure. These must cover the full schema shape from the n8n REST API response:

```typescript
// Core property types in n8n
type N8nPropertyType = 'string' | 'number' | 'boolean' | 'options' | 'multiOptions'
  | 'collection' | 'fixedCollection' | 'resourceLocator' | 'color' | 'json'
  | 'notice' | 'hidden' | 'filter' | 'resourceMapper' | 'assignmentCollection';

interface N8nOption {
  name: string;
  value: string | number | boolean;
  description?: string;
}

interface N8nDisplayOptions {
  show?: Record<string, Array<string | number | boolean>>;
  hide?: Record<string, Array<string | number | boolean>>;
}

interface N8nProperty {
  displayName: string;
  name: string;
  type: N8nPropertyType;
  default?: unknown;
  required?: boolean;
  description?: string;
  placeholder?: string;
  options?: N8nOption[] | N8nProperty[];  // options for 'options' type, sub-properties for collections
  displayOptions?: N8nDisplayOptions;
  typeOptions?: Record<string, unknown>;
  noDataExpression?: boolean;
  // For fixedCollection
  values?: N8nProperty[];
}

interface N8nCredential {
  name: string;
  required?: boolean;
  displayOptions?: N8nDisplayOptions;
}

interface N8nNodeType {
  name: string;           // e.g. "n8n-nodes-base.slack"
  displayName: string;
  version: number | number[];
  description: string;
  defaults: Record<string, unknown>;
  properties: N8nProperty[];
  credentials?: N8nCredential[];
  group?: string[];
}

// API response wrapper
interface N8nNodeTypesResponse {
  data: N8nNodeType[];
}
```

Export all interfaces. This is the canonical schema shape — the extractor stores these, the generator reads them.

5. Create `src/index.ts` as barrel export from schema modules.

6. Run `npm install` to install dependencies.
  </action>
  <verify>
- `npx tsc --noEmit` compiles without errors
- `package.json` has correct scripts and dependencies
- `src/schema/types.ts` exports all schema interfaces
  </verify>
  <done>Project scaffolded with ESM TypeScript, all schema type interfaces defined and compiling</done>
</task>

<task type="auto">
  <name>Task 2: Implement schema extractor and cache with CLI</name>
  <files>src/schema/extractor.ts, src/schema/cache.ts, cli/extract.ts</files>
  <action>
1. Create `src/schema/extractor.ts`:
   - `extractNodeType(nodeType: string): Promise<N8nNodeType>` — fetches single node type from `GET {N8N_API_URL}/api/v1/node-types/{nodeType}` with `X-N8N-API-KEY` header. Parse response JSON.
   - `extractNodeTypes(nodeTypes: string[]): Promise<N8nNodeType[]>` — fetches multiple node types in sequence.
   - `listAvailableNodeTypes(): Promise<string[]>` — fetches `GET {N8N_API_URL}/api/v1/node-types` and returns array of node type names.
   - Read N8N_API_URL and N8N_API_KEY from environment (using dotenv).
   - Use native `fetch` (Node 18+), no axios needed.
   - Handle errors: throw clear messages for 401 (bad API key), 404 (node type not found), network errors.

2. Create `src/schema/cache.ts`:
   - Cache directory: `schemas/` at project root (gitignored but committed via .gitkeep)
   - `writeSchema(nodeType: N8nNodeType): Promise<void>` — writes to `schemas/{name}.json` (replace dots with dashes in filename, e.g. `n8n-nodes-base-slack.json`)
   - `readSchema(nodeTypeName: string): Promise<N8nNodeType>` — reads from cache, throws if not found
   - `listCachedSchemas(): Promise<string[]>` — lists all cached schema filenames
   - `readAllSchemas(): Promise<N8nNodeType[]>` — reads all cached schemas
   - Add `schemas/` to `.gitignore` (create .gitignore if needed), add `schemas/.gitkeep`

3. Create `cli/extract.ts`:
   - Parse CLI args: optional list of node type names, or `--all` flag
   - Default target list: `['n8n-nodes-base.webhook', 'n8n-nodes-base.httpRequest', 'n8n-nodes-base.slack', 'n8n-nodes-base.if', 'n8n-nodes-base.set']` (the v1 scope nodes)
   - Import dotenv/config at top for env loading
   - For each node type: extract via API, write to cache, log progress
   - Summary output: "Extracted N schemas to schemas/"
  </action>
  <verify>
- `npx tsc --noEmit` compiles without errors
- If n8n is running: `npx tsx cli/extract.ts` extracts schemas and creates JSON files in `schemas/`
- `ls schemas/*.json` shows cached schema files
- Each JSON file contains valid node type data with properties array
  </verify>
  <done>Schema extractor pulls from n8n REST API and caches as local JSON files. CLI command works with default v1 node list.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` — zero TypeScript errors
2. `npx tsx cli/extract.ts` — extracts 5 node schemas (requires n8n running)
3. `ls schemas/` — shows 5 JSON files
4. Each JSON file has `properties` array with `displayOptions` entries
</verification>

<success_criteria>
- Project compiles with strict TypeScript
- Schema types accurately model n8n node type structure
- Extractor authenticates and pulls schemas from n8n REST API
- Schemas persist as readable JSON files for offline use
- CLI extract command works with v1 node list
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
