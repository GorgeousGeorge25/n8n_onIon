---
phase: 05-typed-node-api
plan: 02
type: tdd
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/codegen/tests/typed-api.test.ts
  - src/codegen/typed-api.ts
autonomous: true

must_haves:
  truths:
    - "Typed API produces WorkflowNode with correct n8n type string for each of the 5 nodes"
    - "Slack operations auto-inject resource and operation into parameters"
    - "TypeScript compilation fails when invalid params are passed (verified via tsc --noEmit on test fixtures)"
    - "Backward compatible — existing workflow() builder API tests still pass"
  artifacts:
    - path: "src/codegen/tests/typed-api.test.ts"
      provides: "Tests for typed node API correctness"
      contains: "createTypedNodes"
  key_links:
    - from: "src/codegen/tests/typed-api.test.ts"
      to: "src/codegen/typed-api.ts"
      via: "import and exercise createTypedNodes"
      pattern: "createTypedNodes"
---

<objective>
TDD tests verifying the typed node API produces correct WorkflowNode objects and that TypeScript enforces parameter types at compile time.

Purpose: Validate that the typed API bridge between generated types and the builder works correctly.
Output: Comprehensive test suite for the typed node API.
</objective>

<execution_context>
@/Users/jurissleiners/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jurissleiners/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-typed-node-api/05-01-SUMMARY.md

@src/codegen/typed-api.ts
@src/builder/types.ts
</context>

<feature>
  <name>Typed Node API Tests</name>
  <files>src/codegen/tests/typed-api.test.ts, src/codegen/typed-api.ts</files>
  <behavior>
    Test the typed node API factory correctness:

    Cases:
    1. `nodes.webhook('Trigger', { httpMethod: 'POST', path: '/hook' })` -> WorkflowNode with type 'n8n-nodes-base.webhook', parameters { httpMethod: 'POST', path: '/hook' }
    2. `nodes.httpRequest('Fetch', { method: 'GET', url: 'https://api.example.com' })` -> WorkflowNode with type 'n8n-nodes-base.httpRequest'
    3. `nodes.if('Check', { conditions: {} })` -> WorkflowNode with type 'n8n-nodes-base.if'
    4. `nodes.set('Assign', { mode: 'manual' })` -> WorkflowNode with type 'n8n-nodes-base.set'
    5. `nodes.slack.message.post('Notify', { text: 'Hello' })` -> WorkflowNode with type 'n8n-nodes-base.slack', parameters include { resource: 'message', operation: 'post', text: 'Hello' }
    6. `nodes.slack.channel.create('NewChannel', { channelId: 'general', channelVisibility: 'public' })` -> parameters include { resource: 'channel', operation: 'create' }
    7. Verify auto-injection: user does NOT pass resource/operation, factory adds them
    8. Verify WorkflowNode shape: each result has { name, type, parameters }
    9. Integration: typed nodes can be used with workflow builder's connect() (compatible NodeRef shape)
  </behavior>
  <implementation>
    RED: Write failing tests for all 9 cases above.
    GREEN: Fix any issues in typed-api.ts to make tests pass.
    REFACTOR: Clean up if needed.

    For compile-time type checking test:
    - Create a small .ts fixture file with intentionally wrong params
    - Run `npx tsc --noEmit` on it and assert it fails
    - OR use vitest's expectTypeOf() for type-level assertions
  </implementation>
</feature>

<verification>
1. `npm test` — All tests pass including new typed-api tests
2. Test count increases from 52 to 60+ (9+ new tests)
3. No regressions in existing test suites
</verification>

<success_criteria>
- All 9 test cases pass
- Typed API produces correct WorkflowNode for each of the 5 v1 nodes
- Slack resource/operation auto-injection verified
- Total test count: 60+ (52 existing + 8+ new)
</success_criteria>

<output>
After completion, create `.planning/phases/05-typed-node-api/05-02-SUMMARY.md`
</output>
