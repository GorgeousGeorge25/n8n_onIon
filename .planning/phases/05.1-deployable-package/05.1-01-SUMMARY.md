---
phase: 05.1-deployable-package
plan: 01
subsystem: deployer
tags: [n8n-api, deploy, cli, fetch, rest-api]

# Dependency graph
requires:
  - phase: 04-validation
    provides: compileWorkflow, WorkflowBuilder, validated n8n JSON output
provides:
  - deployWorkflow() programmatic API for compile+deploy in one call
  - CLI deploy command (npm run deploy -- <file.ts>)
  - DeployResult and DeployOptions types
affects: [06-foundation-docs, 08-examples-and-reference]

# Tech tracking
tech-stack:
  added: []
  patterns: [deployer-module, cli-deploy-command, n8n-rest-api-integration]

key-files:
  created: [src/deployer/deploy.ts, src/deployer/types.ts, cli/deploy.ts]
  modified: [src/index.ts, package.json]

key-decisions:
  - "Reuse integration test pattern for API calls (strip active field, X-N8N-API-KEY header)"
  - "Env var fallback chain: options > env vars > defaults"
  - "PATCH for activation after initial POST (n8n API requires separate call)"

patterns-established:
  - "Deployer module: compile + POST in single function"
  - "CLI commands follow same pattern: dotenv, dynamic import, call SDK function"

# Metrics
duration: 4min
completed: 2026-01-31
---

# Phase 5.1 Plan 01: Deploy Command Summary

**deployWorkflow() function and CLI deploy command for one-step compile+import to n8n via REST API**

## Performance

- **Duration:** 4 min
- **Started:** 2026-01-31T17:30:33Z
- **Completed:** 2026-01-31T17:35:04Z
- **Tasks:** 2
- **Files modified:** 5

## Accomplishments
- Programmatic `deployWorkflow(builder, options?)` function that compiles and deploys in one call
- CLI `npm run deploy -- <workflow.ts> [--activate]` command for tool-call automation
- Error handling: missing API key, unreachable n8n, rejected workflow — all with descriptive messages
- Activation support via `--activate` flag (PATCH after POST)
- Full end-to-end verified: deployed test workflow to n8n, confirmed via API, cleaned up

## Task Commits

Each task was committed atomically:

1. **Task 1: Create deployer module with deployWorkflow function** - `050d6e1` (feat)
2. **Task 2: Create CLI deploy command and wire up package.json** - `6012c06` (feat)

## Files Created/Modified
- `src/deployer/types.ts` - DeployResult and DeployOptions interfaces
- `src/deployer/deploy.ts` - deployWorkflow() function: compile, POST, optional activate
- `cli/deploy.ts` - CLI deploy command with dotenv, dynamic import, error handling
- `src/index.ts` - Added deployer exports
- `package.json` - Added "deploy" script

## Decisions Made
- Extracted and generalized the `importWorkflow()` pattern from integration tests
- Used env var fallback chain (options.apiKey > N8N_API_KEY env > error) for flexibility
- Separate POST (create) then PATCH (activate) — n8n API does not support creating active workflows in one call

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered
None

## User Setup Required
None - no external service configuration required.

## Next Phase Readiness
- Phase 5.1 complete with 1 plan
- `deployWorkflow()` available as both programmatic API and CLI
- Ready for Phase 6 (Foundation Docs) — deploy command should be documented in SKILL.md and docs

---
*Phase: 05.1-deployable-package*
*Completed: 2026-01-31*
